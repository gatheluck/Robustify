---
title: 'Ascender: Accelerator of Scientific Development and Research'
date: '2022-07-07'
tags: ['python', 'research', 'cvpaper.challenge']
draft: false
summary: Pythonã‚’ç”¨ã„ãŸç ”ç©¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãŸã‚ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆAscenderã‚’å…¬é–‹ã—ã¾ã—ãŸ.
---

## TL;DR

- Python ã‚’ç”¨ã„ãŸç ”ç©¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‘ã‘ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ [Ascender](https://github.com/cvpaperchallenge/Ascender) ã‚’å…¬é–‹.
- ãƒãƒ¼ãƒ ã§ã®ç ”ç©¶ãƒ»é–‹ç™ºãŒæƒ³å®šã•ã‚Œã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã„ã¦æœ‰ç”¨ãªæ©Ÿèƒ½ã‚’ä¸­å¿ƒã«å®Ÿè£….

## Background

ç§ã®æ‰€å±ã—ã¦ã„ã‚‹ [cvpaper.challnege](http://xpaperchallenge.org/cv/) ã§ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã§ç ”ç©¶æ´»å‹•ã‚’è¡Œã£ã¦ã„ã‚‹ãŸã‚, ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼ãŒãã‚Œãã‚Œã®ç’°å¢ƒã§ 1 ã¤ã®ç ”ç©¶ã®ãŸã‚ã®å®Ÿé¨“ã‚³ãƒ¼ãƒ‰ã‚’é–‹ç™ºã™ã‚‹æ©Ÿä¼šãŒé »ç¹ã«ã‚ã‚Šã¾ã™. ã—ã‹ã—, ã“ã‚Œã¾ã§å…±é€šã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚„ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ãŒå­˜åœ¨ã—ã¦ã„ãªã‹ã£ãŸãŸã‚, ã‚³ãƒ¼ãƒ‰ã®å…±æœ‰ã‚„å†åˆ©ç”¨, ãƒãƒ¼ãƒ ã§ã®åŒæ™‚é–‹ç™ºã¯ä¸Šæ‰‹ãå‡ºæ¥ã¦ã„ãªã„çŠ¶æ³ã§ã—ãŸ. ãã“ã§, [XCCV ã‚°ãƒ«ãƒ¼ãƒ—](http://xpaperchallenge.org/cv/xccv) ã® 2022 å¹´ã®ãƒ¡ã‚¿ã‚µãƒ¼ãƒ™ã‚¤æ´»å‹•ã®ä¸€è²«ã¨ã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸ. æœ¬è¨˜äº‹ã§ã¯ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ©Ÿèƒ½ã¨ä½¿ã„æ–¹ã«ã¤ã„ã¦ç°¡å˜ã«ç´¹ä»‹ã—ã¾ã™.

## What is Ascender

ä¸Šè¨˜ã®ã‚ˆã†ãªèƒŒæ™¯ã§ Python ã‚’ç”¨ã„ãŸç ”ç©¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‘ã‘ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã‚ã‚‹ [Ascender](https://github.com/cvpaperchallenge/Ascender) ã‚’ä½œæˆã—ã¾ã—ãŸ. ç‰¹å¾´ã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªç‚¹ãŒã‚ã‚Šã¾ã™.

- **ã‚³ãƒ³ãƒ†ãƒŠä»®æƒ³åŒ–**: [Docker](https://www.docker.com/) ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§é–‹ç™ºç’°å¢ƒä¾å­˜ã‚’æ¸›ã‚‰ã—, ã‚³ãƒ¼ãƒ‰ã®ç§»æ¤æ€§ã‚’å‘ä¸Š.
- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†**: [Poetry](https://github.com/python-poetry/poetry) ã‚’ä½¿ç”¨ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã«ã‚ˆã‚Š, åŒä¸€ç’°å¢ƒã®å†ç¾æ€§ã‚’å‘ä¸Š.
- **ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«**: [Black](https://github.com/psf/black), [Flake8](https://github.com/pycqa/flake8), [isort](https://github.com/PyCQA/isort) ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è‡ªå‹•çš„ã«çµ±ä¸€.
- **é™çš„å‹ãƒã‚§ãƒƒã‚¯**: [Mypy](https://github.com/python/mypy) ã«ã‚ˆã‚‹é™çš„å‹ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚Š, ã‚³ãƒ¼ãƒ‰ã®ä¿¡é ¼æ€§ã‚’å‘ä¸Š.
- **ãƒ†ã‚¹ãƒˆ**: [pytest](https://github.com/pytest-dev/pytest) ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç°¡å˜ã«ä½¿ç”¨å¯èƒ½.
- **GitHub é–¢é€£æ©Ÿèƒ½**: Pull request ä½œæˆæ™‚ã® [workflow](https://docs.github.com/en/actions/using-workflows/about-workflows) ã‚„ [issue ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](https://docs.github.com/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/about-issue-and-pull-request-templates) ç­‰ã‚’å®Ÿè£…æ¸ˆ.

Python ã‚’ç”¨ã„ãŸ ML å‘¨ã‚Šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ã¯, [Cookiecutter Data Science](https://github.com/drivendata/cookiecutter-data-science) ã‚„ [Lightning-Hydra-Template](https://github.com/ashleve/lightning-hydra-template) ãªã©æ—¢ã«åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚‚ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ãŒ, ä»Šå›ã¯ç‰¹ã«ãƒãƒ¼ãƒ ã§ã®åŒæ™‚é–‹ç™ºã‚’ä¸»è»¸ã¨ã—, é–‹ç™ºã®éš›ã«ç‰¹å®šã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆ¶ç´„ã‚’å‡ºæ¥ã‚‹ã ã‘å—ã‘ãªã„ã‚ˆã†ã«ã—ã¾ã—ãŸ.

## Prerequisites

Ascender ã§ã¯é–‹ç™ºç’°å¢ƒã«ã‚ˆã‚‹å½±éŸ¿ã‚’æ¥µåŠ›å°ã•ãã™ã‚‹ãŸã‚ã«, Docker ã‚³ãƒ³ãƒ†ãƒŠå†…ã§é–‹ç™ºã‚’ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™. ãã®ãŸã‚, Ascender ã§é–‹ç™ºã‚’å§‹ã‚ã‚‹æº–å‚™ã¨ã—ã¦ [Docker](https://www.docker.com/), [Docker Compose](https://github.com/docker/compose), [NVIDIA Container Toolkit (nvidia-docker2)](https://github.com/NVIDIA/nvidia-docker) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™. éæ¨å¥¨ã§ã™ãŒ [Docker ã‚’ä½¿ç”¨ã—ãªãã¦ã‚‚ Ascender ã§é–‹ç™ºã‚’è¡Œã†ã“ã¨ã¯å¯èƒ½ã§ã™](https://github.com/cvpaperchallenge/Ascender#use-ascender-without-docker).ãã®ãŸã‚, æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã®æ–¹ã‚„ Docker ã‚’ä½¿ç”¨ã—ãªã„æ–¹ã¯, èª­ã¿é£›ã°ã—ã¦ä¸‹ã•ã„.

ä¸‹è¨˜ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ã‚³ãƒãƒ³ãƒ‰ã¯ Ubuntu ã‚’æƒ³å®šã—ãŸã‚‚ã®ã§ã™, ç•°ãªã‚‹ OS ã§é–‹ç™ºã‚’ã™ã‚‹å ´åˆã¯, ãã‚Œãã‚Œã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã—ã¦é©å®œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä¸‹ã•ã„.

Docker ã¨ Docker Compose ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™.

```shell
% sudo apt update
% sudo apt install docker-ce docker-ce-cli containerd.io docker-compose-plugin
```

`sudo docker run --rm hello-world` ã‚’å®Ÿè¡Œã—ã¦ "Hello from Docker!" ã‹ã‚‰å§‹ã¾ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚Œã° Docker ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡ºæ¥ã¦ã„ã¾ã™.

ã¾ãŸ, GPU ã‚’ä½¿ç”¨ã—ã¦é–‹ç™ºã‚’ã™ã‚‹å ´åˆã¯ NVIDIA Container Toolkit ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™.

```shell
% distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \
      && curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
      && curl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \
            sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
            sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list

% sudo apt update
% sudo apt install -y nvidia-docker2
% sudo systemctl restart docker
```

ã“ã‚Œã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯å®Œäº†ã§ã™. ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ ``

```shell
% sudo docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi
```

## Start development

ã¾ãš, Ascender ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦æ–°ã—ã„ Github ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã—, ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™. [ã“ã¡ã‚‰ã®ãƒªãƒ³ã‚¯](https://github.com/cvpaperchallenge/Ascender/generate)ã‹ã‚‰ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆãƒšãƒ¼ã‚¸ã«é·ç§»ã§ãã¾ã™.

```shell
% git clone git@github.com:<YOUR_USER_NAME>/<YOUR_REPO_NAME>.git
% cd <YOUR_REPO_NAME>
```

Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—, ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™. GPU ç’°å¢ƒã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ [environments/gpu](https://github.com/cvpaperchallenge/Ascender/blob/develop/environments/gpu/docker-compose.yaml), CPU ã®ã¿ã®ç’°å¢ƒã®å ´åˆã¯ [environments/cpu](https://github.com/cvpaperchallenge/Ascender/blob/develop/environments/cpu/docker-compose.yaml) ã®`docker-compose.yaml`ã‚’ä½¿ç”¨ã—ã¦ä¸‹ã•ã„.

```shell
% cd environments/gpu  # CPUã®ã¿ã®ç’°å¢ƒã®å ´åˆã¯`cd environments/cpu`
% sudo docker compose up -d
```

`sudo docker compose exec core bash`ã§ã‚³ãƒ³ãƒ†ãƒŠã®ä¸­ã«å…¥ã‚Š, Poetry ã‚’ä½¿ç”¨ã—ã¦ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ, ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™. `poetry install`ã‚’å®Ÿè¡Œã™ã‚‹ã®ã¯åˆå›ã®ã¿ã§å¤§ä¸ˆå¤«ã§ã™.

```shell
% sudo docker compose exec core bash
$ poetry install
```

ã“ã‚Œã§é–‹ç™ºæº–å‚™å®Œäº†ã§ã™. `sudo docker compose up -d`ã®å®Ÿè¡Œã«ã‚ˆã£ã¦ã‚³ãƒ³ãƒ†ãƒŠå†…ã®`/home/challenger/ascender`ã«[ãƒ›ã‚¹ãƒˆ PC ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒãƒœãƒªãƒ¥ãƒ¼ãƒ ã•ã‚Œã¦ã„ã‚‹](https://github.com/cvpaperchallenge/Ascender/blob/master/environments/gpu/docker-compose.yaml#L18)ã®ã§, ãƒ›ã‚¹ãƒˆ PC ã§ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†ã™ã‚‹ã¨ã‚³ãƒ³ãƒ†ãƒŠå†…ã«åæ˜ ã•ã‚Œã¾ã™. ãã®é€†ã‚‚ã¾ãŸç„¶ã‚Šã§ã™.

ã‚‚ã—, é–‹ç™ºã« Docker ã‚’ä½¿ç”¨ã—ãªã„å ´åˆã¯, ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸå¾Œ, Poetry ã‚’ãƒ­ãƒ¼ã‚«ãƒ« PC ã«ç›´æ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—, `poetry install`ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„.

```shell
% git clone git@github.com:<YOUR_USER_NAME>/<YOUR_REPO_NAME>.git
% cd <YOUR_REPO_NAME>
% python3 -m pip install poetry  # ãƒ­ãƒ¼ã‚«ãƒ«PCã«Poetryã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
% poetry install
```

ãŸã ã—, å¾Œè¿°ã® Github Actions ã® workflow ã¯ Dockerfile ã‚’ç”¨ã„ã¦å‹•ä½œã™ã‚‹ãŸã‚, Dockerfile ã‚’ä½¿ç”¨ã›ãšã«é–‹ç™ºã‚’é€²ã‚ãŸå ´åˆ, PR ã®ä½œæˆæ™‚ç­‰ã« workflow ãŒã‚¨ãƒ©ãƒ¼ã‚’æŒ™ã’ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™. ã‚‚ã—, ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆã¯, Dockerfile ã‚’ä¿®æ­£ã™ã‚‹ã‹, workflow ã‚’å‰Šé™¤ã™ã‚‹ãªã©ã®å¯¾å¿œã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™.

## During development

Ascender ã§ã¯é–‹ç™ºã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã« Poetry, Black, Flake8, isort, Mypy, pytest ã‚’å°å…¥ã—ã¦ãŠã‚Š, Make ã‚’ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã¨ã—ã¦ä½¿ç”¨ã—ã¦å°‘æ•°ã®ã‚³ãƒãƒ³ãƒ‰ã§ç°¡å˜ã«å®Ÿè¡Œå‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™.

### Poetry

Ascender ã§ã¯ Poetry ã‚’ä½¿ç”¨ã—ã¦ Python ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç®¡ç†ã‚’è¡Œãªã£ã¦ã„ã¾ã™. pip ã¨æ¯”è¼ƒã—ã¦ Poetry ã¯ä¸€å®šã®å­¦ç¿’ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚Šã¾ã™ãŒ, Poetry ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§, é–‹ç™ºç’°å¢ƒã®å†ç¾æ€§ã‚’é«˜ã‚ãŸã‚Š, PyPI ã¸ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦å…¬é–‹ã™ã‚‹ã¨ãã®ã‚³ã‚¹ãƒˆã‚‚å°ã•ãæ¸ˆã¿ã¾ã™.
Poetry ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ã®è©³ã—ã„èª¬æ˜ã¯[ã“ã¡ã‚‰ã®è³‡æ–™](https://cvpaperchallenge.github.io/Britannica/poetry101/ja)ã‚„[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://python-poetry.org/docs/)ã‚’å‚ç…§ã—ã¦ä¸‹ã•ã„.

Poetry ã§ã¯ [`poetry add`](https://python-poetry.org/docs/cli/#add) ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™.

```shell
# Poetry ã‚’ç”¨ã„ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
$ poetry add <PACKAGE_NAME>
```

`poetry add` ã‚’å®Ÿè¡Œã—ãŸéš›ã«è‰¯ãæŒ™ãŒã‚‹ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦ `SolverProblemError` ãŒã‚ã‚Šã¾ã™. `SolverProblemError` ã®è§£æ±ºã«ã¤ã„ã¦ã¯, ä¸Šè¨˜ã®è³‡æ–™ã® ["Frequently faced error" ã®ãƒšãƒ¼ã‚¸](https://cvpaperchallenge.github.io/Britannica/poetry101/ja/#/16)ã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ä¸‹ã•ã„.

Poetry ãŒä½œæˆã—ãŸä»®æƒ³ç’°å¢ƒã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ [`poetry run`](https://python-poetry.org/docs/cli/#run) ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™. Poetry ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã®ã«, ãã‚ŒãŒè¦‹ã¤ã‹ã‚‰ãªã„ã¨æ€’ã‚‰ã‚Œã‚‹ã¨ãã¯ `poetry run` ã‚’ã¤ã‘å¿˜ã‚Œã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“.

```shell
# Poetry ãŒä½œæˆã—ãŸä»®æƒ³ç’°å¢ƒã‚’ä½¿ç”¨ã—ã¦ hoge.py ã‚’å®Ÿè¡Œ
$ poetry run python hoge.py
```

ã¾ãŸ, Deep Learning ã‚’ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ Poetry ã‚’ä½¿ç”¨ã™ã‚‹ã¨èµ·ã“ã‚‹å•é¡Œã¨ã—ã¦, PyTorch ã¨ Poetry(v1.1 ç³»)ã®ç›¸æ€§ãŒè‰¯ããªã„ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚Šã¾ã™ãŒ, Ascender ã§ã¯[ãƒ™ãƒ¼ã‚¿ç‰ˆã® Poetry1.2 ç³»ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ PyTorch ã¨ã®ç›¸æ€§å•é¡Œã«å¯¾å‡¦ã—ã¦ã„ã¾ã™](https://github.com/cvpaperchallenge/Ascender#compatibility-issue-between-pytorch-and-poetry). å…·ä½“çš„ãª `pyproject.toml` ã®è¨­å®šã«ã¤ã„ã¦ã¯ Ascender ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹[ã“ã¡ã‚‰ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ](https://github.com/ueda0319/neddf/blob/master/pyproject.toml#L31-L34)ã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ä¸‹ã•ã„.

### Black, Flake8, isort

Ascender ã§ã¯ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’çµ±ä¸€ã™ã‚‹ãŸã‚ã« Black, Flake8, isort ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™. [Makefile](https://github.com/cvpaperchallenge/Ascender/blob/master/Makefile) ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒãƒ³ãƒ‰ï¼ˆ`make format` ã¨ `make lint`ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã‚’ä¸€åº¦ã«é©ç”¨å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™. ã‚³ãƒãƒ³ãƒ‰åã¯ PFN ã® [pysen](https://github.com/pfnet/pysen) ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™.

```shell
# Black ã¨ isort ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
$ make format
# Black, Flake8, isort, mypy ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¨é™çš„ãªå‹ã‚’ç¢ºèª (ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯è¡Œã‚ãªã„)
$ make lint
```

ã‚¹ã‚¿ã‚¤ãƒ«ã®è¨­å®šã‚’èª¿æ•´ã—ãŸã„å ´åˆã¯, Black ã¨ isort ã«ã¤ã„ã¦ã¯ [`pyproject.toml`](https://github.com/cvpaperchallenge/Ascender/blob/master/pyproject.toml) ã« Flake8 ã«ã¤ã„ã¦ã¯ [`.flake8`](https://github.com/cvpaperchallenge/Ascender/blob/master/.flake8) ã«ãã‚Œãã‚Œè¨­å®šãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã®ã§, å¿…è¦ã«å¿œã˜ã¦é©å®œç·¨é›†ã—ã¦ä¸‹ã•ã„. å„ãƒ„ãƒ¼ãƒ«ã§è¨­å®šå¯èƒ½ãªé …ç›®ã¯ãã‚Œãã‚Œä¸‹è¨˜ã®ãƒªãƒ³ã‚¯å…ˆã‚’å‚ç…§ã—ã¦ä¸‹ã•ã„.

- [Black ã®è¨­å®šé …ç›®](https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html#configuration-via-a-file)
- [Flake8 ã®è¨­å®šé …ç›®](https://flake8.pycqa.org/en/latest/user/configuration.html)
- [isort ã®è¨­å®šé …ç›®](https://pycqa.github.io/isort/docs/configuration/options.html)

### Mypy

Ascender ã§ã¯ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã¨ä¿¡é ¼æ€§ã®å‘ä¸Šã®ãŸã‚ã«å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¯èƒ½ãªé™ã‚Šä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—, Mypy ã«ã‚ˆã‚‹é™çš„å‹ãƒã‚§ãƒƒã‚¯ã‚’å°å…¥ã—ã¦ã„ã¾ã™.
Python ã®å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ä»˜ã‘æ–¹ã«ã¤ã„ã¦ç¢ºèªã‚’ã—ãŸã„æ–¹ã¯ [Mypy ã®ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ](https://mypy.readthedocs.io/en/stable/cheat_sheet_py3.html)ã‚„ [Python ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã® typing ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒšãƒ¼ã‚¸](https://docs.python.org/3/library/typing.html)ã‚’å‚ç…§ã—ã¦ä¸‹ã•ã„. Mypy ã«ã‚ˆã‚‹é™çš„å‹ãƒã‚§ãƒƒã‚¯ã¯æ—¢ã«ç´¹ä»‹æ¸ˆã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚ã‚‹ `make lint` ã«ã‚ˆã£ã¦ä»–ã®ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚‹ãƒã‚§ãƒƒã‚¯ã¨åˆã‚ã›ã¦å®Ÿè¡ŒãŒå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™.

```shell
# Black, Flake8, isort, mypy ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¨é™çš„ãªå‹ã‚’ç¢ºèª (ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯è¡Œã‚ãªã„)
$ make lint
```

Mypy ã®è¨­å®šã«ã¤ã„ã¦ã¯ [`pyproject.toml`](https://github.com/cvpaperchallenge/Ascender/blob/master/pyproject.toml) ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™. è¨­å®šãŒå¯èƒ½ãªé …ç›®ã«ã¤ã„ã¦ã¯ [Mypy ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://mypy.readthedocs.io/en/stable/config_file.html)ã‚’å‚ç…§ã—ã¦ä¸‹ã•ã„.

### pytest

Ascender ã§ã¯ãƒ†ã‚¹ãƒˆã®ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ [pytest](https://github.com/pytest-dev/pytest) ã‚’å°å…¥ã—ã¦ã„ã¾ã™. pytest ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„ã¨æ–¹ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.pytest.org)ã‚„ [M3 Tech Blog ã®å°æœ¬ã•ã‚“ã®è¨˜äº‹](https://www.m3tech.blog/entry/pytest-summary)ã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ä¸‹ã•ã„.

ç ”ç©¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§é–‹ç™ºé€Ÿåº¦ã‚’çŠ ç‰²ã«ã—ã¦ã¾ã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ãå¿…è¦ãŒæœ¬å½“ã«ã‚ã‚‹ã®ã‹ï¼Ÿã¨ã„ã†è«–ç‚¹ã¯å½“ç„¶ã‚ã‚‹ã¨æ€ã„ã¾ã™. ä¾‹ãˆã°, ãƒ†ã‚¹ãƒˆã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ä¸Šã’ã‚‹ã¨ã„ã£ãŸã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã—ã¾ã†ã¨æœ¬æœ«è»¢å€’ã«ãªã‚Šã‹ã­ã¾ã›ã‚“. ã—ã‹ã—, æ‰‹æ³•ã®ä¸­å¿ƒã¨ãªã‚‹é‡è¦ãªé–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ã«ã¤ã„ã¦ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã¯è‡´å‘½çš„ãªãƒã‚°ã‚’ç™ºè¦‹ã‚’å®¹æ˜“ã«ã—ãŸã‚Š, ä»–ã®ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒé–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹éš›ã®ç†è§£ã‚’åŠ©ã‘ãŸã‚Šã¨, ä¸€å®šã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰²ãã«å€¤ã™ã‚‹åˆ©ç‚¹ãŒã‚ã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™.

`make test` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ [`tests` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª](https://github.com/cvpaperchallenge/Ascender/tree/d35ba431d7dd2816f7a32ed43ceaa7e00afa2f83/tests)ä¸‹ã«é…ç½®ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™. ã¾ãŸ, `make test-all` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨, ã“ã‚Œã¾ã§ç´¹ä»‹ã—ã¦ããŸ, Black, Flake8, isort, Mypy, pytest ã‚’ç”¨ã„ãŸãƒã‚§ãƒƒã‚¯ã‚’ä¸€åº¦ã«è¡Œã†ã“ã¨ãŒå‡ºæ¥ã¾ã™.

```shell
# pytest ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
$ make test
# Black, Flake8, isort, Mypy, pytest ã«ã‚ˆã‚‹ãƒã‚§ãƒƒã‚¯ã‚’ä¸€åº¦ã«å®Ÿè¡Œ
$ make test-all
```

## Stop development

é–‹ç™ºãŒçµ‚äº†ã—ãŸã‚‰å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ã—ã¦ä¸‹ã•ã„.

```bash
% cd environments/gpu  # CPU ã®ã¿ã®ç’°å¢ƒã®å ´åˆã¯ `cd environments/cpu`
% sudo dokcer compose stop
```

ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã—ãŸã„å ´åˆã¯ä»£ã‚ã‚Šã« `sudo dokcer compose down` ã‚’ä½¿ç”¨ã—ã¦ä¸‹ã•ã„.

## Inline Highlighting

Sample of inline highlighting `sum = parseInt(num1) + parseInt(num2)`

## Code Blocks

Some Javascript code

```javascript
var num1, num2, sum
num1 = prompt('Enter first number')
num2 = prompt('Enter second number')
sum = parseInt(num1) + parseInt(num2) // "+" means "add"
alert('Sum = ' + sum) // "+" means combine into a string
```

Some Python code ğŸ

```python
def fib():
    a, b = 0, 1
    while True:            # First iteration:
        yield a            # yield 0 to start with and then
        a, b = b, a + b    # a will now be 1, and b will also be 1, (0 + 1)

for index, fibonacci_number in zip(range(10), fib()):
     print('{i:3}: {f:3}'.format(i=index, f=fibonacci_number))
```

## References

**Ascender ä»¥å¤–ã® Python ã‚’ç”¨ã„ãŸ ML å‘¨ã‚Šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**

1. [Cookiecutter Data Science](https://github.com/drivendata/cookiecutter-data-science)
1. [Lightning-Hydra-Template](https://github.com/ashleve/lightning-hydra-template)
1. []()
